<div id="store_details_container">
    <script id="store_details_template" type="x-tmpl-mustache/text">
        <div class="header_banner stores_banner">
            <div class="main_container">
                <h4 class="header_banner_heading" id="store_name" data-value='{{x_coordinate}},{{y_coordinate}},{{id}}'>{{name}}</h4>
            </div>
        </div>
        <div class="main_container mobile_padding">
            
        </div>
    </script>
</div>

<!-- Hours Template -->
    <script id="reg_hours_template" type="x-tmpl-mustache/text">
        <tr>
            <td class="hours_left">
                {{day}}
            </td>   
            <td class="hours_right">
                {{hour_string}}
            </td>
        </tr>
    </script>
<!-- End Hours Template -->

<!-- Promotions Template -->
<script id="promos_template" type="x-tmpl-mustache/text">
    <div class="promo_row">
        <div class="promo_col_3" style="{{promo_image}}">
            <img src="{{promo_image_url_abs}}" alt="Promotion" class="" />
        </div>
        <div class="promo_col_9" style="{{full_width}}">
            <p class="colored_link">{{name}}</p>
            <h3 class="publish_date">{{dates}}</h3>
            <div class="details_desc">{{description_short}}</div>
            <a href="/promotions/{{slug}}" class="read_more">Read More</a>
        </div>
    </div>
    <hr class="promo_separator" />
</script>
<!-- End Promotions Template -->


<!-- Jobs Template-->
<script id="jobs_template" type="x-tmpl-mustache/text">
    <div class="row">
        <div class="col-md-12">
            <p class="colored_link">{{name}}</p>
            <h3 class="publish_date">{{dates}}</h3>
            <a href="/jobs/{{slug}}" class="read_more">View Requirements</a>
        </div>
    </div>
    <hr class="promo_separator" />
</script>
<!-- End Jobs Template-->

<script src="http://kodekloud.s3.amazonaws.com/sites/54d4e9206e6f64691f000000/d9e054e28dd1bad70a952dd85777e93f/jquery.smoothZoom.min.js"></script>s
<script>
    $(document).ready(function(e){
        init(e);
        loadMallDataCached(renderPage);
        if($(window).width() <= 768){
            $('.details_header').click()
        }
        
    })
    
    $(window).load(function(e){
        show_png_pin_without_link($('#store_name').attr('data-value'), $('#store_name').text(), "#png_map")
    })
    
    function renderPage(){
        var pathArray = window.location.pathname.split( '/' );
        var slug = pathArray[pathArray.length-1];
        var store_details = getStoreDetailsBySlug(slug);
        
        renderStoreDetails('#store_details_container','#store_details_template', store_details);
        var hour_ids = store_details.store_hours;
        if (hour_ids.length > 0){
            var hours = getHoursForIds(hour_ids);
            renderStoreDetailsHours('#reg_hours_container','#reg_hours_template', hours, 'reg_hours');
        }
        else{
            $('#reg_hours_container').hide();
        }
        var store_promo_ids = store_details.promotions
        var store_promos = getPromotionsForIds(store_promo_ids).sortBy(function(o){ return o.start_date });
        var published_promos = [];
        $.each( store_promos , function( key, val ){
            today = new Date();
            webDate = new Date(val.show_on_web_date)
            if (today >= webDate) {
                published_promos.push(val)
            } 
        });
        if( published_promos.length > 0){
            renderPromotions("#promos_container","#promos_template", published_promos);
        }
        else{
            $('#promotions_header').hide();
        }
        
        var store_job_ids = store_details.jobs
        var store_jobs = getJobsForIds(store_job_ids).sortBy(function(o){ return o.start_date });
        var published_jobs = [];
        $.each( store_jobs , function( key, val ){
            today = new Date();
            webDate = new Date(val.show_on_web_date)
            if (today >= webDate) {
                published_jobs.push(val)
            } 
        });
        if( published_jobs.length > 0){
            renderJobs('#jobs_container', '#jobs_template', published_jobs);
        }
        else{
            $('#jobs_header').hide();
        }
        show_content();
        var stores = getStoresList();
        $("#png_map").attr("src", getPNGMapURL())
		$('#png_map').smoothZoom({
		      height: 496,
		    width: 619,
		    initial_ZOOM: 26,
			zoom_MIN: 26,
			zoom_MAX: 100,
			responsive: true,
		    responsive_maintain_ratio: true,
			zoom_BUTTONS_SHOW : 'YES',
			pan_BUTTONS_SHOW : 'NO',
			pan_LIMIT_BOUNDARY : 'NO',
			button_ALIGN: "top left",
			container: 'zoom_container'
		});
    }
</script>